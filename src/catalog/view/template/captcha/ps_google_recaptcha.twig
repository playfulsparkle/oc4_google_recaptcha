<div class="row mb-3 required">
	<label for="input-google-recaptcha" class="col-sm-2 col-form-label">
		{% if key_type == 'v2_checkbox' %}
			{{ entry_challange_captcha }}
		{% else %}
			{{ entry_score_based_captcha }}
		{% endif %}
	</label>
	<div class="col-sm-10">
		{% if key_type == 'v3' or key_type == 'v2_invisible' %}
			<script src="https://www.google.com/recaptcha/api.js?render={{ site_key }}{% if badge_position != 'inline' %}&badge={{ badge_position }}{% endif %}" async defer></script>
			<script>
					var form = document.currentScript ? document.currentScript.closest('form') : null;

					function onFormSubmit{{ widget_counter }}(token) {
							if (form) {
									var submitEvent = new Event('submit', { bubbles: true, cancelable: true });

									if (form.dispatchEvent(submitEvent)) {
											form.submit();
									}
							} else {
									console.error("No form element found for the current script.");
							}
					}
			</script>
		{% elseif key_type == 'v2_checkbox' %}
			<div id="g-recaptcha-{{ widget_counter }}" data-sitekey="{{ site_key }}"></div>
			<script type="text/javascript">
				var recaptcha_widget{{ widget_counter }};

				var onloadCallback{{ widget_counter }} = function () {
					recaptcha_widget{{ widget_counter }} = grecaptcha.render('g-recaptcha-{{ widget_counter }}', {
						'sitekey': '{{ site_key }}',
						'theme': '{{ badge_theme }}',
						'size': '{{ badge_size }}'
					});
				};

				var form = document.currentScript ? document.currentScript.closest('form') : null;

				if (typeof form !== 'undefined') {
					var resetRecaptcha{{ widget_counter }} = function () {
						if (window.grecaptcha && typeof grecaptcha.reset === 'function') {
							grecaptcha.reset(recaptcha_widget{{ widget_counter }});
						} else {
							console.warn('Google reCAPTCHA is not initialized.');
						}
					};

					form.addEventListener('submit', function () {
						setTimeout(resetRecaptcha{{ widget_counter }}, 1000);
					});
				}
			</script>
			<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback{{ widget_counter }}&render=explicit&badge={{ badge_position }}" async defer></script>
		{% endif %}
		<div id="error-captcha" class="invalid-feedback"></div>
	</div>
</div>
